# DuggeeStake - å¤šä»£å¸è´¨æŠ¼æŒ–çŸ¿ DApp

[![Solidity](https://img.shields.io/badge/Solidity-0.8.13-blue.svg)](https://solidity.readthedocs.io/)
[![Foundry](https://img.shields.io/badge/Foundry-0.2.0-lightgrey.svg)](https://book.getfoundry.sh/)
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)

ä¸€ä¸ªå®Œæ•´çš„å¤šä»£å¸è´¨æŠ¼æŒ–çŸ¿å»ä¸­å¿ƒåŒ–åº”ç”¨ï¼Œæ”¯æŒå¤šç§ä»£å¸æ± è´¨æŠ¼ã€å¥–åŠ±åˆ†é…å’Œçµæ´»çš„è´¨æŠ¼ç®¡ç†ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

DuggeeStake æ˜¯ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„å»ä¸­å¿ƒåŒ–è´¨æŠ¼æŒ–çŸ¿å¹³å°ï¼Œç”¨æˆ·å¯ä»¥è´¨æŠ¼å¤šç§ç±»å‹çš„ä»£å¸æ¥è·å¾—å¥–åŠ±ä»£å¸ã€‚é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼ŒåŒ…å«æ™ºèƒ½åˆçº¦å’Œå‰ç«¯ç•Œé¢ä¸¤å¤§éƒ¨åˆ†ã€‚

## å›¾ç¤º

![img/1.png](img/1.png)

![img/2.png](img/2.png)

### ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
metanode-advanced2-stake/
â”œâ”€â”€ stake-contract/          # æ™ºèƒ½åˆçº¦ç›®å½•
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ DuggeeStake.sol  # ä¸»è´¨æŠ¼åˆçº¦
â”‚   â”‚   â”œâ”€â”€ DuggeeToken.sol  # ä»£å¸åˆçº¦
â”‚   â”‚   â””â”€â”€ MyTimelockController.sol # æ—¶é—´é”åˆçº¦
â”‚   â”œâ”€â”€ script/              # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ test/                # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ lib/                 # ä¾èµ–åº“
â”‚   â””â”€â”€ foundry.toml         # Foundry é…ç½®
â”œâ”€â”€ stake-fe/                # å‰ç«¯åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ src/                 # æºä»£ç 
â”‚   â”œâ”€â”€ public/              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json         # ä¾èµ–é…ç½®
â”‚   â””â”€â”€ README.md            # å‰ç«¯æ–‡æ¡£
â”œâ”€â”€ img/                     # é¡¹ç›®å›¾ç‰‡
â”œâ”€â”€ README.md                # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ TODO.md                  # å¼€å‘ä»»åŠ¡æ¸…å•
```

## â­ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ å¤šä»£å¸æ± æ”¯æŒ
- **çµæ´»çš„æ± ç®¡ç†**: æ”¯æŒåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„è´¨æŠ¼æ± ï¼Œæ¯ä¸ªæ± å¯é…ç½®ä¸åŒçš„ä»£å¸
- **æƒé‡åˆ†é…ç³»ç»Ÿ**: æ¯ä¸ªæ± å¯è®¾ç½®ç‹¬ç«‹çš„æƒé‡ï¼Œç”¨äºåˆ†é…æ€»å¥–åŠ±
- **è‡ªå®šä¹‰å‚æ•°**: æ¯ä¸ªæ± æ”¯æŒè®¾ç½®æœ€å°è´¨æŠ¼æ•°é‡ç­‰ä¸ªæ€§åŒ–å‚æ•°

### ğŸ’ æ™ºèƒ½è´¨æŠ¼æœºåˆ¶
- **ETH & ERC20 æ”¯æŒ**: åŒæ—¶æ”¯æŒåŸç”Ÿ ETH å’Œå„ç§ ERC20 ä»£å¸è´¨æŠ¼
- **å®æ—¶å¥–åŠ±è®¡ç®—**: åŸºäºåŒºå—æ•°é‡çš„å®æ—¶å¥–åŠ±ç´¯ç§¯æœºåˆ¶
- **é˜²é‡å…¥æ”»å‡»**: é›†æˆ ReentrancyGuard ä¿æŠ¤ç”¨æˆ·èµ„é‡‘å®‰å…¨

### ğŸ”’ å®‰å…¨è®¾è®¡
- **å¯å‡çº§åˆçº¦**: åŸºäº UUPS ä»£ç†æ¨¡å¼ï¼Œæ”¯æŒåˆçº¦å‡çº§
- **è®¿é—®æ§åˆ¶**: åŸºäº OpenZeppelin çš„è§’è‰²æƒé™ç®¡ç†
- **ç´§æ€¥æš‚åœ**: æ”¯æŒåœ¨å¼‚å¸¸æƒ…å†µä¸‹æš‚åœå„é¡¹æ“ä½œ
- **æ—¶é—´é”æœºåˆ¶**: é‡è¦æ“ä½œéœ€è¦æ—¶é—´é”å»¶è¿Ÿæ‰§è¡Œ

### ğŸ›ï¸ ç®¡ç†åŠŸèƒ½
- **åŠ¨æ€æš‚åœæ§åˆ¶**: å¯ç‹¬ç«‹æ§åˆ¶è´¨æŠ¼ã€æå–ã€é¢†å–å¥–åŠ±åŠŸèƒ½
- **å¥–åŠ±å‚æ•°è°ƒæ•´**: æ”¯æŒè°ƒæ•´æ¯åŒºå—å¥–åŠ±æ•°é‡å’Œé”å®šæœŸ
- **æ± æƒé™ç®¡ç†**: ç®¡ç†å‘˜å¯åˆ›å»ºå’Œç®¡ç†è´¨æŠ¼æ± 

## ğŸš€ åŠŸèƒ½æ¨¡å—

### 1. æ™ºèƒ½åˆçº¦åŠŸèƒ½

#### DuggeeStake åˆçº¦
- **æ± ç®¡ç†**: åˆ›å»ºã€é…ç½®å’Œç®¡ç†å¤šä¸ªè´¨æŠ¼æ± 
- **è´¨æŠ¼æ“ä½œ**: æ”¯æŒå¤šç§ä»£å¸çš„è´¨æŠ¼å’Œè§£é™¤è´¨æŠ¼
- **å¥–åŠ±è®¡ç®—**: å®æ—¶è®¡ç®—å’Œåˆ†é…è´¨æŠ¼å¥–åŠ±
- **èµ„é‡‘ç®¡ç†**: å®‰å…¨çš„èµ„é‡‘è½¬ç§»å’Œæå–æœºåˆ¶

#### DuggeeToken åˆçº¦
- **æ ‡å‡† ERC20**: å®Œå…¨å…¼å®¹ ERC20 æ ‡å‡†
- **é“¸é€ åŠŸèƒ½**: æ”¯æŒé“¸é€ æ–°çš„ä»£å¸ç”¨äºå¥–åŠ±

#### MyTimelockController åˆçº¦
- **æ—¶é—´é”æ§åˆ¶**: é‡è¦æ“ä½œéœ€è¦å»¶è¿Ÿæ‰§è¡Œ
- **å¤šé‡ç­¾å**: æ”¯æŒå¤šç­¾åéªŒè¯æé«˜å®‰å…¨æ€§

### 2. å‰ç«¯ç•Œé¢åŠŸèƒ½

#### ç”¨æˆ·æ“ä½œç•Œé¢
- **é’±åŒ…è¿æ¥**: æ”¯æŒ MetaMask ç­‰ä¸»æµé’±åŒ…
- **è´¨æŠ¼ä¿¡æ¯æŸ¥è¯¢**: å®æ—¶æ˜¾ç¤ºç”¨æˆ·è´¨æŠ¼æ•°æ®å’Œå¥–åŠ±
- **æ± ä¿¡æ¯å±•ç¤º**: å±•ç¤ºå„æ± çš„ç»Ÿè®¡æ•°æ®å’Œæƒé‡ä¿¡æ¯

#### äº¤æ˜“åŠŸèƒ½
- **è´¨æŠ¼æ“ä½œ**: ä¸€é”®è´¨æŠ¼å¤šç§ä»£å¸
- **è§£é™¤è´¨æŠ¼**: çµæ´»çš„è§£é™¤è´¨æŠ¼å’Œé”å®šæœºåˆ¶
- **å¥–åŠ±é¢†å–**: ä¾¿æ·çš„å¥–åŠ±é¢†å–å’Œæå–
- **èµ„é‡‘æå–**: è§£é”åçš„æœ¬é‡‘æå–

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Solidity ^0.8.13**: æ™ºèƒ½åˆçº¦å¼€å‘è¯­è¨€
- **Foundry**: ä»¥å¤ªåŠå¼€å‘æ¡†æ¶
- **OpenZeppelin**: å®‰å…¨çš„åˆçº¦åº“
- **Hardhat**: å…¼å®¹çš„å¼€å‘ç¯å¢ƒ

### å‰ç«¯æŠ€æœ¯
- **React**: ç°ä»£åŒ–å‰ç«¯æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨çš„ JavaScript
- **Next.js**: å…¨æ ˆ React æ¡†æ¶
- **Web3.js**: ä»¥å¤ªåŠäº¤äº’åº“
- **Ethers.js**: ä»¥å¤ªåŠ JavaScript åº“

### å¼€å‘å·¥å…·
- **Git**: ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- **Node.js**: JavaScript è¿è¡Œæ—¶
- **npm/yarn**: åŒ…ç®¡ç†å™¨
- **VS Code**: æ¨èçš„å¼€å‘ç¯å¢ƒ

## ğŸ“– å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- Git
- MetaMask æˆ–å…¼å®¹çš„é’±åŒ…

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/your-repo/metanode-advanced2-stake.git
   cd metanode-advanced2-stake
   ```

2. **å®‰è£…åˆçº¦ä¾èµ–**
   ```bash
   cd stake-contract
   foundry install
   ```

3. **å®‰è£…å‰ç«¯ä¾èµ–**
   ```bash
   cd ../stake-fe
   npm install
   ```

4. **ç¼–è¯‘åˆçº¦**
   ```bash
   cd ../stake-contract
   forge build
   ```

5. **è¿è¡Œæµ‹è¯•**
   ```bash
   forge test
   ```

6. **éƒ¨ç½²åˆçº¦**
   ```bash
   forge script script/Deploy.s.sol --rpc-url <your-rpc-url> --private-key <your-private-key>
   ```

7. **å¯åŠ¨å‰ç«¯**
   ```bash
   cd ../stake-fe
   npm run dev
   ```

### é…ç½®è¯´æ˜

1. **ç½‘ç»œé…ç½®**
   - åœ¨ `stake-fe/src/config/networks.ts` ä¸­é…ç½®ç½‘ç»œä¿¡æ¯
   - è®¾ç½® RPC URL å’Œé“¾ ID

2. **åˆçº¦åœ°å€**
   - åœ¨éƒ¨ç½²åæ›´æ–°åˆçº¦åœ°å€é…ç½®
   - ç¡®ä¿åœ°å€ä¸ç½‘ç»œåŒ¹é…

3. **ç¯å¢ƒå˜é‡**
   - å¤åˆ¶ `.env.example` åˆ° `.env`
   - é…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·ä½¿ç”¨æµç¨‹

1. **è¿æ¥é’±åŒ…**
   - ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®
   - æˆæƒé’±åŒ…è¿æ¥

2. **æŸ¥çœ‹è´¨æŠ¼ä¿¡æ¯**
   - é€‰æ‹©ä»£å¸æ± 
   - æŸ¥çœ‹å½“å‰ APR å’Œæ± ç»Ÿè®¡

3. **è´¨æŠ¼ä»£å¸**
   - è¾“å…¥è´¨æŠ¼æ•°é‡
   - ç¡®è®¤äº¤æ˜“
   - ç­‰å¾…åŒºå—ç¡®è®¤

4. **ç®¡ç†è´¨æŠ¼**
   - å‘èµ·è§£é™¤è´¨æŠ¼
   - ç­‰å¾…é”å®šæœŸç»“æŸ
   - æå–æœ¬é‡‘

5. **é¢†å–å¥–åŠ±**
   - æŸ¥çœ‹å¯é¢†å–å¥–åŠ±
   - ä¸€é”®é¢†å–å¥–åŠ±

### ç®¡ç†å‘˜æ“ä½œ

1. **åˆ›å»ºæ–°æ± **
   - è°ƒç”¨ `createPool()` å‡½æ•°
   - è®¾ç½®ä»£å¸åœ°å€å’Œæƒé‡
   - é…ç½®æœ€å°è´¨æŠ¼æ•°é‡

2. **å‚æ•°è°ƒæ•´**
   - ä¿®æ”¹å¥–åŠ±å‚æ•°
   - è°ƒæ•´é”å®šæ—¶é—´
   - æ›´æ–°æ± æƒé‡

3. **å®‰å…¨ç®¡ç†**
   - ç´§æ€¥æš‚åœåŠŸèƒ½
   - åˆçº¦å‡çº§æ“ä½œ
   - æ—¶é—´é”ç®¡ç†

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test

# è¿è¡Œç‰¹å®šæµ‹è¯•
forge test --match-test testName

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
forge test -vvv

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
forge coverage
```

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… è´¨æŠ¼å’Œè§£é™¤è´¨æŠ¼åŠŸèƒ½
- âœ… å¥–åŠ±è®¡ç®—å’Œé¢†å–
- âœ… æƒé™æ§åˆ¶å’Œå®‰å…¨æ€§
- âœ… ç´§æ€¥æš‚åœæœºåˆ¶
- âœ… åˆçº¦å‡çº§æµç¨‹

## ğŸ“Š API æ–‡æ¡£

### ä¸»è¦åˆçº¦æ¥å£

#### DuggeeStake

```solidity
// åˆ›å»ºè´¨æŠ¼æ± 
function createPool(
    address _tokenAddress,
    uint256 _weight,
    uint256 _minStakeAmount,
    bool _withupdate
) external;

// è´¨æŠ¼ä»£å¸
function stake(
    address tokenAddress,
    uint256 amount
) public payable;

// è§£é™¤è´¨æŠ¼
function unstake(
    address tokenAddress,
    uint256 _amount
) public;

// é¢†å–å¥–åŠ±
function claim(address tokenAddress) public;

// æå–æœ¬é‡‘
function withdraw(address tokenAddress) external;

// è·å–æ± ä¿¡æ¯
function getPool(uint256 pid) public view returns (Pool memory);

// è·å–è´¨æŠ¼è€…ä¿¡æ¯
function getStaker(address tokenAddress, address staker)
    public view returns (Staker memory);
```

## ğŸ›¡ï¸ å®‰å…¨æ€§

### å®‰å…¨ç‰¹æ€§
- **é‡å…¥æ”»å‡»ä¿æŠ¤**: ä½¿ç”¨ ReentrancyGuard
- **æƒé™æ§åˆ¶**: åŸºäº OpenZeppelin AccessControl
- **æš‚åœæœºåˆ¶**: æ”¯æŒç´§æ€¥æƒ…å†µä¸‹çš„æ“ä½œæš‚åœ
- **åˆçº¦å‡çº§**: UUPS ä»£ç†æ¨¡å¼æ”¯æŒå®‰å…¨å‡çº§
- **æ—¶é—´é”**: é‡è¦æ“ä½œéœ€è¦å»¶è¿Ÿæ‰§è¡Œ

### å®¡è®¡å»ºè®®
- å»ºè®®è¿›è¡Œä¸“ä¸šå®‰å…¨å®¡è®¡
- ä½¿ç”¨è‡ªåŠ¨åŒ–å®‰å…¨æ£€æµ‹å·¥å…·
- å®šæœŸæ£€æŸ¥ä¾èµ–åº“çš„å®‰å…¨æ›´æ–°

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç è§„èŒƒ
- éµå¾ª Solidity æœ€ä½³å®è·µ
- ä½¿ç”¨ TypeScript è¿›è¡Œå‰ç«¯å¼€å‘
- ç¼–å†™å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- æ·»åŠ å¿…è¦çš„ä»£ç æ³¨é‡Š

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- [OpenZeppelin](https://openzeppelin.com/) - å®‰å…¨çš„æ™ºèƒ½åˆçº¦åº“
- [Foundry](https://book.getfoundry.sh/) - ä¼˜ç§€çš„å¼€å‘æ¡†æ¶
- [React](https://reactjs.org/) - å¼ºå¤§çš„å‰ç«¯æ¡†æ¶
- [Web3.js](https://web3js.readthedocs.io/) - ä»¥å¤ªåŠäº¤äº’åº“

---

**âš ï¸ å…è´£å£°æ˜**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼Œè¯·è¿›è¡Œå…¨é¢çš„å®‰å…¨å®¡è®¡ã€‚
